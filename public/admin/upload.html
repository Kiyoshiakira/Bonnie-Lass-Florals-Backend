<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Upload | Bonnie Lass Florals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Use relative path for CSS since we're in /public/admin/ -->
  <link rel="stylesheet" href="../styles.css">
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBo4GNnJd8awnviuIlo9mJ9vaar8jvf6G0",
      authDomain: "bonnie-lass-florals.firebaseapp.com",
      projectId: "bonnie-lass-florals",
      storageBucket: "bonnie-lass-florals.firebasestorage.app",
      messagingSenderId: "1009091302977",
      appId: "1:1009091302977:web:2322ff602eccee4509d8c0",
      measurementId: "G-DQRB98D0WY"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
  <nav>
    <a href="../index.html">Home</a>
    <a href="../about.html">About</a>
    <a href="../shop.html">Shop</a>
    <a href="../gallery.html">Gallery</a>
    <a href="../contact.html">Contact</a>
    <a href="../cart.html" class="cart-btn">ðŸ›’ Cart <span id="cart-count">0</span></a>
    <a href="../profile.html">Profile</a>
    <a href="upload.html" style="background: #d946ef; color: #fff; border-radius: 0.5em; padding: 0.5em 1em;">Upload</a>
  </nav>
  <main>
    <h1>Upload New Product</h1>
    <form id="uploadForm" enctype="multipart/form-data">
      <label for="name">Product Name</label>
      <input type="text" id="name" name="name" required>

      <label for="description">Description</label>
      <textarea id="description" name="description" required></textarea>

      <label for="price">Price</label>
      <input type="number" id="price" name="price" step="0.01" required>

      <label for="type">Type</label>
      <select id="type" name="type" required>
        <option value="decor">Decor</option>
        <option value="food">Cottage Food</option>
      </select>

      <label for="subcategory">Subcategory</label>
      <input type="text" id="subcategory" name="subcategory">

      <label for="stock">Stock</label>
      <input type="number" id="stock" name="stock" min="1" value="1" required>

      <label for="options">Options (comma separated)</label>
      <input type="text" id="options" name="options" placeholder="e.g. Small,Medium,Large">

      <label for="image">Product Image</label>
      <input type="file" id="image" name="image" accept="image/*" required>

      <button type="submit">Upload Product</button>
    </form>
    <div id="upload-success" style="color:green;display:none;margin-top:1rem;">Product uploaded successfully!</div>
    <div id="upload-error" style="color:red;display:none;margin-top:1rem;"></div>
  </main>
  <script>
    // Cart count
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      document.querySelectorAll('.cart-btn span').forEach(el => el.textContent = cart.length);
    }
    updateCartCount();

    // Upload product
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      document.getElementById('upload-success').style.display = "none";
      document.getElementById('upload-error').style.display = "none";

      const formData = new FormData();
      formData.append("name", document.getElementById('name').value);
      formData.append("description", document.getElementById('description').value);
      formData.append("price", document.getElementById('price').value);
      formData.append("type", document.getElementById('type').value);
      formData.append("subcategory", document.getElementById('subcategory').value);
      formData.append("stock", document.getElementById('stock').value);
      formData.append("options", document.getElementById('options').value);
      formData.append("image", document.getElementById('image').files[0]);

      try {
        const res = await fetch('/api/products', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();
        if (res.ok) {
          document.getElementById('upload-success').style.display = "block";
          document.getElementById('uploadForm').reset();
        } else {
          document.getElementById('upload-error').textContent = data.error || 'Upload failed.';
          document.getElementById('upload-error').style.display = "block";
        }
      } catch (err) {
        document.getElementById('upload-error').textContent = 'Network error!';
        document.getElementById('upload-error').style.display = "block";
      }
    });
  </script>
</body>
</html>
